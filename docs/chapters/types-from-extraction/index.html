<!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Types from Extraction</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" media="screen" href="../../css/handbook.css" />
    </head>
    <body>
    <article>
    <h1 id="types-from-extraction"><a href="#types-from-extraction">Types from Extraction</h1></a>
<p>TypeScript's type system is very powerful because it allows expressing types <em>in terms of other types</em>.
Although the simplest form of this is generics, we actually have a wide variety of <em>type operators</em> available to us.
It's also possible to express types in terms of <em>values</em> that we already have.</p>
<p>By combining various type operators, we can express complex operations and values in a succinct, maintainable way.
In this chapter we'll cover ways to express a type in terms of an existing type or value.</p>
<div class="toc"><span class="toc-title">Table of Contents</span><ul><li><a href="#typeof">The <code>typeof</code> type operator </a></li><ul><li><a href="#limitations">Limitations</a></li></ul><li><a href="#keyof">The <code>keyof</code> type operator</a></li><li><a href="#indexed-access-types">Indexed Access Types</a></li></ul></ul></div>
<h2 id="typeof"><a href="#typeof">The <code>typeof</code> type operator </h2></a>
<p>JavaScript already has a <code>typeof</code> operator you can use in an <em>expression</em> context:</p>
<p><pre class="typescript-code"><span class="comment">// Prints "string"</span>
<span class="identifier">console</span><span class="punctuation">.</span><span class="identifier">log</span><span class="punctuation">(</span><span class="keyword">typeof</span> <span class="stringLiteral">"Hello world"</span><span class="punctuation">)</span><span class="punctuation">;</span></pre></p>
<p>TypeScript adds a <code>typeof</code> operator you can use in a <em>type</em> context to refer to the <em>type</em> of a variable or property:</p>
<p><pre class="typescript-code"><span class="keyword">let</span> <span class="identifier">s</span> <span class="operator">=</span> <span class="stringLiteral">"hello"</span><span class="punctuation">;</span>
<span class="keyword">let</span> <span class="identifier">n</span><span class="punctuation">:</span> <span class="keyword">typeof</span> <span class="identifier">s</span><span class="punctuation">;</span>
    <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">let</span><span class="space"> </span><span class="localName">n</span><span class="punctuation">:</span><span class="space"> </span><span class="keyword">string</span></span></pre></p>
<p>This isn't very useful for basic types, but combined with other type operators, you can use <code>typeof</code> to conveniently express many patterns.
For an example, let's start by looking at the predefined type <code>ReturnType&lt;T&gt;</code>.
It takes a <em>function type</em> and produces its return type:</p>
<p><pre class="typescript-code"><span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">Predicate</span></span> <span class="punctuation">=</span> <span class="punctuation">(</span><span class="parameterName">x</span><span class="punctuation">:</span> <span class="keyword">unknown</span><span class="punctuation">)</span> <span class="punctuation">=></span> <span class="keyword">boolean</span><span class="punctuation">;</span>
<span class="comment">// K is just "boolean"</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">K</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">ReturnType</span></span><span class="punctuation"><</span><span class="typeAliasName"><span class="identifier">Predicate</span></span><span class="punctuation">></span><span class="punctuation">;</span><a class="playground-link" href="https://www.typescriptlang.org/play/#src=type%20Predicate%20%3D%20(x%3A%20unknown)%20%3D%3E%20boolean%3B%0A%2F%2F%20K%20is%20just%20%22boolean%22%0Atype%20K%20%3D%20ReturnType%3CPredicate%3E%3B">Try</a></pre></p>
<p>If we try to use <code>ReturnType</code> on a function name, we see an instructive error:</p>
<p><pre class="typescript-code"><span class="keyword">function</span> <span class="identifier">f</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="punctuation">{</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="numericLiteral">10</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">:</span> <span class="numericLiteral">3</span> <span class="punctuation">}</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">P</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">ReturnType</span></span><span class="punctuation"><</span><span class="error"><span class="error-highlight"></span><span class="identifier">f</span></span><span class="punctuation">></span><span class="punctuation">;</span><hr class="error-divider"><div class="listed-error"><div class="error-line">'f' refers to a value, but is being used as a type here.</div></div><a class="playground-link" href="https://www.typescriptlang.org/play/#src=function%20f()%20%7B%0A%20%20%20%20return%20%7B%20x%3A%2010%2C%20y%3A%203%20%7D%3B%0A%7D%0Atype%20P%20%3D%20ReturnType%3Cf%3E%3B">Try</a></pre></p>
<p>Remember that <em>values</em> and <em>types</em> aren't the same thing.
To refer to the <em>type</em> that the <em>value <code>f</code></em> has, we use <code>typeof</code>:</p>
<p><pre class="typescript-code"><span class="keyword">function</span> <span class="identifier">f</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <span class="punctuation">{</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="numericLiteral">10</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">:</span> <span class="numericLiteral">3</span> <span class="punctuation">}</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">P</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">ReturnType</span></span><span class="punctuation"><</span><span class="keyword">typeof</span> <span class="identifier">f</span><span class="punctuation">></span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">P</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="punctuation">{</span><span class="lineBreak">
</span><span class="space">    </span><span class="propertyName">x</span><span class="punctuation">:</span><span class="space"> </span><span class="keyword">number</span><span class="punctuation">;</span><span class="lineBreak">
</span><span class="space">    </span><span class="propertyName">y</span><span class="punctuation">:</span><span class="space"> </span><span class="keyword">number</span><span class="punctuation">;</span><span class="lineBreak">
</span><span class="punctuation">}</span></span><a class="playground-link" href="https://www.typescriptlang.org/play/#src=function%20f()%20%7B%0A%20%20%20%20return%20%7B%20x%3A%2010%2C%20y%3A%203%20%7D%3B%0A%7D%0Atype%20P%20%3D%20ReturnType%3Ctypeof%20f%3E%3B">Try</a></pre></p>
<h3 id="limitations"><a href="#limitations">Limitations</h3></a>
<p>TypeScript intentionally limits the sorts of expressions you can use <code>typeof</code> on.
Specifically, it's only legal to use <code>typeof</code> on identifiers (i.e. variable names) or their properties.
This helps avoid the confusing trap of writing code you think is executing, but isn't:</p>
<p><pre class="typescript-code">
<span class="comment">// Meant to use =</span>
<span class="keyword">let</span> <span class="identifier">x</span> <span class="punctuation">:</span> <span class="typeAliasName"><span class="identifier">msgbox</span></span><span class="error"><span class="error-highlight"></span><span class="punctuation">(</span></span><span class="stringLiteral">"Are you sure you want to continue?"</span><span class="punctuation">)</span><span class="punctuation">;</span><hr class="error-divider"><div class="listed-error"><div class="error-line">',' expected.</div></div></pre></p>
<h2 id="keyof"><a href="#keyof">The <code>keyof</code> type operator</h2></a>
<p>The <code>keyof</code> operator takes a type and produces a string or numeric literal union of its keys:</p>
<p><pre class="typescript-code"><span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">Point</span></span> <span class="punctuation">=</span> <span class="punctuation">{</span> <span class="identifier">x</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">,</span> <span class="identifier">y</span><span class="punctuation">:</span> <span class="keyword">number</span> <span class="punctuation">}</span><span class="punctuation">;</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">P</span></span> <span class="punctuation">=</span> <span class="keyword">keyof</span> <span class="typeAliasName"><span class="identifier">Point</span></span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">P</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="stringLiteral">"x"</span><span class="space"> </span><span class="punctuation">|</span><span class="space"> </span><span class="stringLiteral">"y"</span></span></pre></p>
<p>If the type has a <code>string</code> or <code>number</code> index signature, <code>keyof</code> will return those types instead:</p>
<p><pre class="typescript-code"><span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">Arrayish</span></span> <span class="punctuation">=</span> <span class="punctuation">{</span> <span class="punctuation">[</span><span class="parameterName">n</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">]</span><span class="punctuation">:</span> <span class="keyword">unknown</span> <span class="punctuation">}</span><span class="punctuation">;</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">A</span></span> <span class="punctuation">=</span> <span class="keyword">keyof</span> <span class="typeAliasName"><span class="identifier">Arrayish</span></span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">A</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="keyword">number</span></span>

<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">Mapish</span></span> <span class="punctuation">=</span> <span class="punctuation">{</span> <span class="punctuation">[</span><span class="parameterName">k</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">]</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">}</span><span class="punctuation">;</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">M</span></span> <span class="punctuation">=</span> <span class="keyword">keyof</span> <span class="typeAliasName"><span class="identifier">Mapish</span></span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">M</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="keyword">string</span><span class="space"> </span><span class="punctuation">|</span><span class="space"> </span><span class="keyword">number</span></span><a class="playground-link" href="https://www.typescriptlang.org/play/#src=type%20Arrayish%20%3D%20%7B%20%5Bn%3A%20number%5D%3A%20unknown%20%7D%3B%0Atype%20A%20%3D%20keyof%20Arrayish%3B%0A%0Atype%20Mapish%20%3D%20%7B%20%5Bk%3A%20string%5D%3A%20boolean%20%7D%3B%0Atype%20M%20%3D%20keyof%20Mapish%3B">Try</a></pre>
Note that in this example, <code>M</code> is <code>string | number</code> -- this is because JavaScript object keys are always coerced to a string, so <code>obj[0]</code> is always the same as <code>obj["0"]</code>.</p>
<p><code>keyof</code> types become especially useful when combined with mapped types, which we'll learn more about later.</p>
<h2 id="indexed-access-types"><a href="#indexed-access-types">Indexed Access Types</h2></a>
<p>We can use <code>typeof</code> to reference the type of a property of a value.
What if we want to reference the type of a property of a type instead?</p>
<p>We can use an <em>indexed access type</em> to look up a specific property on another type:</p>
<p><pre class="typescript-code"><span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">Person</span></span> <span class="punctuation">=</span> <span class="punctuation">{</span> <span class="identifier">age</span><span class="punctuation">:</span> <span class="keyword">number</span><span class="punctuation">,</span> <span class="identifier">name</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">,</span> <span class="identifier">alive</span><span class="punctuation">:</span> <span class="keyword">boolean</span> <span class="punctuation">}</span><span class="punctuation">;</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">A</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">Person</span></span><span class="punctuation">[</span><span class="stringLiteral">"age"</span><span class="punctuation">]</span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">A</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="keyword">number</span></span></pre></p>
<p>The indexing type is itself a type, so we can use unions, <code>keyof</code>, or other types entirely:</p>
<p><pre class="typescript-code">
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">I1</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">Person</span></span><span class="punctuation">[</span><span class="stringLiteral">"age"</span> <span class="punctuation">|</span> <span class="stringLiteral">"name"</span><span class="punctuation">]</span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">I1</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="keyword">string</span><span class="space"> </span><span class="punctuation">|</span><span class="space"> </span><span class="keyword">number</span></span>

<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">I2</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">Person</span></span><span class="punctuation">[</span><span class="keyword">keyof</span> <span class="typeAliasName"><span class="identifier">Person</span></span><span class="punctuation">]</span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">I2</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="keyword">string</span><span class="space"> </span><span class="punctuation">|</span><span class="space"> </span><span class="keyword">number</span><span class="space"> </span><span class="punctuation">|</span><span class="space"> </span><span class="keyword">boolean</span></span>

<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">AliveOrName</span></span> <span class="punctuation">=</span> <span class="stringLiteral">"alive"</span> <span class="punctuation">|</span> <span class="stringLiteral">"name"</span><span class="punctuation">;</span>
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">I3</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">Person</span></span><span class="punctuation">[</span><span class="typeAliasName"><span class="identifier">AliveOrName</span></span><span class="punctuation">]</span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">I3</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="keyword">string</span><span class="space"> </span><span class="punctuation">|</span><span class="space"> </span><span class="keyword">boolean</span></span><a class="playground-link" href="https://www.typescriptlang.org/play/#src=type%20Person%20%3D%20%7B%20age%3A%20number%2C%20name%3A%20string%2C%20alive%3A%20boolean%20%7D%3B%0A%2F%2Fcut%0Atype%20I1%20%3D%20Person%5B%22age%22%20%7C%20%22name%22%5D%3B%0A%0Atype%20I2%20%3D%20Person%5Bkeyof%20Person%5D%3B%0A%0Atype%20AliveOrName%20%3D%20%22alive%22%20%7C%20%22name%22%3B%0Atype%20I3%20%3D%20Person%5BAliveOrName%5D%3B">Try</a></pre></p>
<p>You may even see an error if you try to index a property that doesn't exist:</p>
<p><pre class="typescript-code">
<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">I1</span></span> <span class="punctuation">=</span> <span class="typeAliasName"><span class="identifier">Person</span></span><span class="punctuation">[</span><span class="error"><span class="error-highlight"></span><span class="stringLiteral">"alve"</span></span><span class="punctuation">]</span><span class="punctuation">;</span><hr class="error-divider"><div class="listed-error"><div class="error-line">Property 'alve' does not exist on type 'Person'.</div></div></pre></p>
<p>Another example of indexing with an arbitrary type is using <code>number</code> to get the type of an array's elements.
We can combine this with <code>typeof</code> to conveniently capture the element type of an array literal:</p>
<p><pre class="typescript-code"><span class="keyword">const</span> <span class="identifier">MyArray</span> <span class="operator">=</span> <span class="punctuation">[</span>
    <span class="punctuation">{</span> <span class="identifier">name</span><span class="punctuation">:</span> <span class="stringLiteral">"Alice"</span><span class="punctuation">,</span> <span class="identifier">age</span><span class="punctuation">:</span> <span class="numericLiteral">15</span> <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">{</span> <span class="identifier">name</span><span class="punctuation">:</span> <span class="stringLiteral">"Bob"</span><span class="punctuation">,</span> <span class="identifier">age</span><span class="punctuation">:</span> <span class="numericLiteral">23</span> <span class="punctuation">}</span><span class="punctuation">,</span>
    <span class="punctuation">{</span> <span class="identifier">name</span><span class="punctuation">:</span> <span class="stringLiteral">"Eve"</span><span class="punctuation">,</span> <span class="identifier">age</span><span class="punctuation">:</span> <span class="numericLiteral">38</span> <span class="punctuation">}</span>
<span class="punctuation">]</span><span class="punctuation">;</span>

<span class="keyword">type</span> <span class="typeAliasName"><span class="identifier">T</span></span> <span class="punctuation">=</span> <span class="punctuation">(</span><span class="keyword">typeof</span> <span class="identifier">MyArray</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="keyword">number</span><span class="punctuation">]</span><span class="punctuation">;</span>
     <span class="quickinfo-result"><span class="quickinfo-arrow">▲</span><span class="keyword">type</span><span class="space"> </span><span class="aliasName">T</span><span class="space"> </span><span class="operator">=</span><span class="space"> </span><span class="punctuation">{</span><span class="lineBreak">
</span><span class="space">    </span><span class="propertyName">name</span><span class="punctuation">:</span><span class="space"> </span><span class="keyword">string</span><span class="punctuation">;</span><span class="lineBreak">
</span><span class="space">    </span><span class="propertyName">age</span><span class="punctuation">:</span><span class="space"> </span><span class="keyword">number</span><span class="punctuation">;</span><span class="lineBreak">
</span><span class="punctuation">}</span></span><a class="playground-link" href="https://www.typescriptlang.org/play/#src=const%20MyArray%20%3D%20%5B%0A%20%20%20%20%7B%20name%3A%20%22Alice%22%2C%20age%3A%2015%20%7D%2C%0A%20%20%20%20%7B%20name%3A%20%22Bob%22%2C%20age%3A%2023%20%7D%2C%0A%20%20%20%20%7B%20name%3A%20%22Eve%22%2C%20age%3A%2038%20%7D%0A%5D%3B%0A%0Atype%20T%20%3D%20(typeof%20MyArray)%5Bnumber%5D%3B">Try</a></pre></p>
    </article>

    <script src="https://unpkg.com/popper.js@1/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@4"></script>
    <script>
        tippy.setDefaults({preventOverflow: { enabled: false } });
    </script>
    </body>
    </html>